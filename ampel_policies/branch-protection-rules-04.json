{
    "id": "My Policy for Branch Protection",
    "meta": {
        "frameworks": [
            { "id": "MyOrg-Branch-Protection-Rules", "name": "MyOrg Branch Protection Rules" }
        ]
    },
    "policies": [
        {
            "id": "OSPS-QA-07.01",
            "meta": {
                "runtime": "cel@v14.0",
                "assert_mode": "OR",
                "description": "VCS MUST require at least one non-author approval of changes to the primary branch",
                "controls": [ { "framework": "OSPS", "class": "QA", "id": "07" } ]
            },
            "tenets": [
                {
                    "code": "has(predicates[0].data.values) ? predicates[0].data.values.exists(rule, rule.type == \"update\") : false",
                    "predicates": {
                        "types": ["http://github.com/carabiner-dev/snappy/specs/branch-rules.yaml"]
                    }
                },
                {
                    "code": "has(predicates[0].data.values) ? predicates[0].data.values.exists(rule, rule.type == \"non_fast_forward\") : false",
                    "predicates": {
                        "types": ["http://github.com/carabiner-dev/snappy/specs/branch-rules.yaml"]
                    }
                },
                {
                    "code": "has(predicates[0].data.values) ? predicates[0].data.values.exists(rule, rule.type == \"pull_request\" && rule.parameters.required_approving_review_count >= 1) : false",
                    "predicates": {
                        "types": ["http://github.com/carabiner-dev/snappy/specs/branch-rules.yaml"]
                    }
                }
            ]
        },
        {
            "id": "OSPS-AC-03.02",
            "meta": {
                "description": "VCS MUST treat main branch deletion as a sensitive activity and require explicit confirmation of intent",
                "controls": [ { "framework": "OSPS", "class": "AC", "id": "03" } ]
            },
            "tenets": [
                {
                    "code": "has(predicates[0].data.values) ? predicates[0].data.values.exists(rule, rule.type == \"deletion\") : false",
                    "predicates": {
                        "types": ["http://github.com/carabiner-dev/snappy/specs/branch-rules.yaml"]
                    }
                }
            ]
        },
        {
            "id": "MYORG-01",
            "meta": {
                "description": "Require CODEOWNER approval before merging",
                "controls": [ { "framework": "MYORG", "class": "ORG", "id": "01" } ]
            },
            "tenets": [
                {
                    "code": "has(predicates[0].data.values) ? predicates[0].data.values.exists(rule, rule.type == \"pull_request\" && rule.parameters.require_code_owner_review == true) : false",

                    "predicates": {
                        "types": ["http://github.com/carabiner-dev/snappy/specs/branch-rules.yaml"]
                    }
                }
            ]
        },
        {
            "id": "MYORG-02",
            "meta": {
                "description": "Require signed commits before merging",
                "controls": [ { "framework": "MYORG", "class": "ORG", "id": "02" } ]
            },
            "tenets": [
                {
                    "code": "has(predicates[0].data.values) ? predicates[0].data.values.exists(rule, rule.type == \"required_signatures\") : false",

                    "predicates": {
                        "types": ["http://github.com/carabiner-dev/snappy/specs/branch-rules.yaml"]
                    }
                }
            ]
        },
        {
            "id": "MYORG-03",
            "meta": {
                "description": "Ensure approvals are updated and compliant when changes are made",
                "controls": [ { "framework": "MYORG", "class": "ORG", "id": "03" } ]
            },
            "tenets": [
                {
                    "code": "has(predicates[0].data.values) ? predicates[0].data.values.exists(rule, rule.type == \"pull_request\" && rule.parameters.dismiss_stale_reviews_on_push == true) : false",

                    "predicates": {
                        "types": ["http://github.com/carabiner-dev/snappy/specs/branch-rules.yaml"]
                    }
                }
            ]
        },
        {
            "id": "MYORG-04",
            "meta": {
                "description": "Ensure approvals are updated and compliant when changes are made",
                "controls": [ { "framework": "MYORG", "class": "ORG", "id": "04" } ]
            },
            "tenets": [
                {
                    "code": "has(predicates[0].data.values) ? predicates[0].data.values.exists(rule, rule.type == \"pull_request\" && rule.parameters.dismiss_stale_reviews_on_push == true) : false",

                    "predicates": {
                        "types": ["http://github.com/carabiner-dev/snappy/specs/branch-rules.yaml"]
                    }
                },
                {
                    "code": "has(predicates[0].data.values) ? predicates[0].data.values.exists(rule, rule.type == \"required_signatures\") : false",

                    "predicates": {
                        "types": ["http://github.com/carabiner-dev/snappy/specs/branch-rules.yaml"]
                    }
                }
            ]
        }
    ]
}
